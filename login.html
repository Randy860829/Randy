<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="stylesheet" href="css/cssReset.css">
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="https://unpkg.com/purecss@2.1.0/build/pure-min.css"
        integrity="sha384-yHIFVG6ClnONEA5yB5DJXfW2/KC173DIQrYoZMEtBvGzmf0PKiGyNEqe9N6BNDBH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
        integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <title>開心漢堡會員登入</title>
</head>

<body>
    <div class="wrap">
        <div class="header"></div>
        <div class="sauce"></div>
        <div class="vegetable"></div>
        <div class="tomato"></div>
        <div class="beef"></div>
        <div class="content">
            <div class="form-login">
                <h2>Burger & Ha.開心漢堡</h2>
                <form class="pure-form pure-form-stacked">
                    <fieldset>
                        <h3>LOGIN</h3>
                        <div class="userInfo">
                            <label for="stacked-email">Email Address*</label>
                            <input type="email" class="form-login-text email" id="stacked-email" placeholder="Email" />
                            <label for="stacked-password">Password*</label>
                            <input type="password" class="form-login-text password" id="stacked-password"
                                placeholder="Password" />
                            <a href="" class="getPassword">忘記密碼?</a>
                        </div>
                        <div class="btn-style">
                            <button type="button" class="pure-button pure-button-primary signUp">註冊</button>
                            <button type="button" class="pure-button pure-button-primary orange login">登入</button>
                        </div>

                    </fieldset>
                </form>
            </div>
        </div>
        <div class="vegetable"></div>
        <div class="tomato"></div>
        <div class="beef"></div>
        <div class="footer"></div>
    </div>

    <script>
        let email = document.querySelector('.email');
        let password = document.querySelector('.password');
        let signUp = document.querySelector('.signUp');
        let login = document.querySelector('.login');
        let emailRule = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/;
        // console.log(email,password,signUp);

        //註冊開始
        signUp.addEventListener('click', function (e) {
            if (email.value == '' || password.value == '') {
                Swal.fire({
                    icon: 'warning',
                    title: '信箱或密碼不得為空'
                })
                return;
            }
            if (email.value.search(emailRule) == -1) {
                Swal.fire({
                    icon: 'warning',
                    title: '信箱格式錯誤',
                })
                email.value = '',
                    password.value = ''
                return;
            }
            let obj = {
                // email: '1111@gmail.com',
                // password: '0829'
            };
            obj.email = email.value;
            obj.password = password.value;
            // console.log(obj);

            axios.post('https://hexschool-tutorial.herokuapp.com/api/signup', obj)
                .then(function (response) {
                    if (response.data.message == '帳號註冊成功') {
                        Swal.fire({
                            icon: 'success',
                            title: `${response.data.message}`,
                        })
                        email.value = '',
                            password.value = ''
                    } else {
                        Swal.fire({
                            icon: 'warning',
                            title: `${error.data.message}`,
                        });
                        email.value = '',
                            password.value = ''
                    }

                })
                .catch(function (error) {
                    Swal.fire({
                        icon: 'warning',
                        title: `帳號已被使用`,
                    });
                    email.value = '',
                        password.value = ''
                });
        });
        //註冊結束



        //登入開始
        login.addEventListener('click', function (e) {
            if (email.value == '' || password.value == '') {
                Swal.fire({
                    icon: 'warning',
                    title: '信箱或密碼不得為空'
                })
                return;
            };
            if (email.value.search(emailRule) == -1) {
                Swal.fire({
                    icon: 'warning',
                    title: '信箱格式錯誤',
                })
                email.value = '',
                    password.value = ''
                return;
            };
            let obj = {};
            obj.email = email.value;
            obj.password = password.value;
            axios.post('https://hexschool-tutorial.herokuapp.com/api/signin', obj)
                .then(function (response) {
                    if (response.data.message == '登入成功') {
                        Swal.fire({
                            icon: 'success',
                            title: `${response.data.message}`,
                        })
                        email.value = '',
                            password.value = ''
                    }else{
                        Swal.fire({
                            icon: 'error',
                            title: `帳號或密碼錯誤`,
                        })
                        email.value = '',
                        password.value = ''
                    }
                })
                .catch(function (error) {
                    console.log(error.data)
                })
        });
        //登入結束

    </script>
</body>

</html>